<!DOCTYPE html>
<meta charset="utf-8">
<!--A series of basic data visualizations using Javascript and the D3 libary
these are based loosely on the bubble pack layout examples by Mike Bostock 

d3 bubble pack-style data visualization with a twist - pulls directly from 
database via the associated php script - displays place names from a library 
catalog - size of bubble is based on number of records with that place name.
Clicking on the bubble opens a search for that place name in the catalog in 
a new browser window.
-->
<style>
	text {
	font: 12px sans-serif;
	}
</style>

<body>
  <div id="container" class="container">
    <header>
    <h1>Geographic Subjects : number of records</h1>
    </header>
    <div id="main" role="main">
      <div id="view_selection" class="btn-group">
        <a href="placeQuantSize.html" id="all" class="btn active">By Size</a>
      </div>

<!--Begin D3 Script Here -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

var diameter = 1260, //set area or canvas for visualization
    format = d3.format(",d"),
	//fooling around with random selections for rgb color
	red = Math.floor((Math.random() * 255) + 69);
	grn = Math.floor((Math.random() * 255) + 70);
	blu = Math.floor((Math.random() * 255) + 71);
	color = "rgb("+red+","+grn+","+blu+")"; 

	
var bubble = d3.layout.pack()
    .sort(null)
    .size([diameter, diameter])
    .padding(12.5);

var svg = d3.select("body").append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");
	
// source data as JSON
d3.json("placeQuant.php", function(error, root) {  
  var node = svg.selectAll(".node")
      .data(bubble.nodes(classes(root))
      .filter(function(d) { return !d.children; }))
      .enter().append("g")
      .attr("class", "node")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; 
	  });

	  
  node.append("title")
      .text(function(d) { return d.className + ": " + format(d.value); })


  node.append("svg:circle")  //create the circles with radius based on size attribute
      .attr("r", function(d) { return (d.r*1.15); })
	  .style("fill", function(d) { return "rgb("+red+","+grn+","+Math.floor(d.r*3)+")"})	  
	  .on("click", function(d) { // make text label link
		var url = d.url + d.className;  //add the current name to the end of the url
		window.open( url ); //open the link in new window
	 })


	  
  node.append("text")   // create text label from the name attribute
      .attr("dy", ".3em")
      .style("text-anchor", "middle")
      .text(function(d) { return d.className.substring(0, d.r / 3.3); })
	  .on("click", function(d) { // make text label link
	    var url = d.url + d.className; //add the current name to the end of the url
		window.open( url );  //open the link in new window
		});
	  
	  
});

// Returns a flat hierarchy containing all nodes.
function classes(root) {
  var classes = [];

  function recurse(name, node) {
    if (node.children) node.children.forEach(function(child) { recurse(node.name, child); });
    else classes.push({packageName: name, className: node.name, value: node.size, url: node.url});
  }

  recurse(null, root);
  return {children: classes};
}

d3.select(self.frameElement).style("height", diameter + "px");

</script>
</body></html>
